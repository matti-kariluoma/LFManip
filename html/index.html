<html>
<head>
	<title>LFManip</title>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" media="screen" href="style.css" />
</head>

<body>
	<div id="canContainer">
		<canvas id="theCanvas">
			<p>Your browser doesn't support canvas, or javascript is disabled!</p>
		</canvas>
	</div>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="lfmanip.js"></script>
	<script src="jquery.mousewheel.min.js"></script>
	
	<script>
		// global state for the renderer
		var canContext = $('#theCanvas')[0].getContext('2d');
		var offset = {
				x: 0,
				y: 0,
				magnitude: 10,
			}
			
		var canvasRenderer = function()
		{	
			var canWidth = $('#theCanvas').width();
			var canHeight = $('#theCanvas').height();
			
			var center = {
					x: canWidth/2,
					y: canHeight/2
				};
      
      canContext.clearRect(0, 0, canWidth, canHeight);
      
      var offscreen_buffer = document.createElement('canvas');
      var offContext = offscreen_buffer.getContext('2d');
      
      var img = lfmanip.getImage(0);
      
      offscreen_buffer.width = img.width;
      offscreen_buffer.height = img.height;
			offContext.drawImage(img, 0, 0);
			var imgData = offContext.getImageData(0, 0, img.width, img.height);
			for(var i=0; i<img.height; i++)
			{
				for(var j=0; j<img.width; j++)
				{
					//var r = imgData.data[((i*(img.width*4)) + (j*4))];
					//var g = imgData.data[((i*(img.width*4)) + (j*4)) + 1];
					//var b = imgData.data[((i*(img.width*4)) + (j*4)) + 2];
					//var a = imgData.data[((i*(img.width*4)) + (j*4)) + 3];
					imgData.data[((i*(img.width*4)) + (j*4) + 3)] = 127; // a = 0.5
				}
			}
			offContext.putImageData(imgData, 0, 0);
			
			canContext.drawImage(offscreen_buffer, center.x - img.width/2 + offset.x, center.y - img.height/2 + offset.y);
			
			canContext.fillStyle = "black";
			canContext.font = "bold 16px Arial";
			var canText = canWidth+"x"+canHeight;
			canContext.fillText(canText, 0, 20);
		}
		
		var canvasMousewheel = function(event, delta, dx, dy)
		{
      
			if (delta > 0) // scroll up
			{
				
			}
			else if (delta < 0) // scroll down
			{
				
			}
			
			if (dx > 0) // scroll east
			{
				offset.x = offset.x + offset.magnitude;
			}
			else if (dx < 0) // scroll west
			{
				offset.x = offset.x - offset.magnitude;
			}
			
			if (dy > 0) // scroll north
			{
				offset.y = offset.y + offset.magnitude;
			}
			else if (dy < 0) // scroll south
			{
				offset.y = offset.y - offset.magnitude;
			}
			
			return false; // prevent default
		}
		
		var canvasClick = function(event)
		{
			return false;
		}
		
		var config = {
				filenames: [
						'Shot1/CW.01_MINI0064.JPG',
						'Shot1/CW.02_MINI0048.JPG',
						'Shot1/CW.03_MINI0022.JPG',
						'Shot1/CW.04_MINI0065.JPG',
						'Shot1/CW.05_MINI0065.JPG',
						'Shot1/CW.06_MINI0063.JPG',
						'Shot1/CW.07_MINI0228.JPG',
						'Shot1/CW.08_MINI0056.JPG'
					],
				render: canvasRenderer,
				canvas: $('#theCanvas'),
				wheel: canvasMousewheel,
				click: canvasClick,	
			};
		lfmanip.init(config);
		lfmanip.start();

	</script>
</body>
</html>
